<!DOCTYPE html><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=google-site-verification content=uV7Lko0q31ot2kgRjnMeU4sN5Fx4Whld80ItNCYYkA4><meta name=theme-color content=#942a39><link rel=license href=https://github.com/isiahmeadows/website/blob/gh-pages/LICENSE><link rel=stylesheet href=/page.css><link rel=stylesheet href=/blog/index.css><link rel="shortcut icon" href=/favicon.ico><link rel=alternate type=application/atom+xml href=/blog/atom.xml title="Atom feed"><link rel=alternate type=application/rss+xml href=/blog/rss.xml title="RSS feed"><title>Isiah Meadows - Blog - I like ES6...works well, even for golfing (factorial demo hack)</title><div id=content><div id=header><nav><div><a href=/ >Isiah Meadows</a></div><div><div class="link l1"><a href=/about/ >About</a></div><div class="link l2"><a href=/showcase/ >Showcase</a></div><div class="link l3"><a class=selected href=/blog/ >Blog</a></div><div class="link l4"><a href=/contact/ >Contact</a></div></div></nav></div><div id=content-body><div id=body-wrapper><div><h2 class=l3><a href=/blog/ >Blog</a></h2><div id=body><div id=blog><div class=blog-post><div class=blog-post-wrapper><a class=post-home href=/blog/ >Home ►</a><h3 class=post-title>I like ES6...works well, even for golfing (factorial demo hack)</h3><div class=post-body><p><em>Edit (2016-01-14): Remove license disclaimer, re-license it under site&#39;s general license. I also fixed typography/grammar/bugs/clarity/etc. throughout.</em></p>
<p><em>Update: updated much of the code, made the JS smaller and the assembly half the instruction size. Also fixed the max line length for comments to 80 characters.</em></p>
<p>Most of you all probably already understand basic JavaScript and the factorial function. Here&#39;s the canonical recursive implementation in JavaScript:</p>
<pre><code class="hljs hljs-js"><span class=hljs-comment>// Function declaration</span>
<span class=hljs-function><span class=hljs-keyword>function</span> <span class=hljs-title>fact</span>(<span class=hljs-params>n</span>) </span>{
    <span class=hljs-keyword>if</span> (x &gt; <span class=hljs-number>0</span>) {
        <span class=hljs-keyword>return</span> n * factorial(n - <span class=hljs-number>1</span>);
    } <span class=hljs-keyword>else</span> {
        <span class=hljs-keyword>return</span> <span class=hljs-number>1</span>;
    }
}

<span class=hljs-comment>// ES6 arrow function</span>
<span class=hljs-keyword>let</span> fact = <span class=hljs-function><span class=hljs-params>n</span> =&gt;</span> n &gt; <span class=hljs-number>0</span> ? n * fact(n - <span class=hljs-number>1</span>) : <span class=hljs-number>1</span>;
</code></pre>
<p>But, I find this hack fairly cool: it basically <del>abuses</del>takes enormous advantage of precedence and how logic statements work in ECMAScript. The hack assumes integer input.</p>
<pre><code class="hljs hljs-js"><span class=hljs-comment>// Function declaration</span>
<span class=hljs-function><span class=hljs-keyword>function</span> <span class=hljs-title>fact</span>(<span class=hljs-params>n</span>) </span>{
    <span class=hljs-keyword>return</span> +(n &lt; <span class=hljs-number>1</span>) || n * fact(n - <span class=hljs-number>1</span>);
}

<span class=hljs-comment>// ES6 arrow function</span>
<span class=hljs-keyword>let</span> fact = <span class=hljs-function><span class=hljs-params>n</span> =&gt;</span> +(n &lt; <span class=hljs-number>1</span>) || n * fact(n - <span class=hljs-number>1</span>);
</code></pre>
<p>The hack version also takes advantage of an implicit boolean-to-integer cast, which is usually much shorter than a conditional. Code golfing is a little fun for these kinds of hacks, so let&#39;s compare a golfed C/C++ version to this ECMAScript hack unminified (using the ES6 versions):</p>
<pre><code class="hljs hljs-js"><span class=hljs-comment>// Golfed C/C++</span>
int f(int n){int r=<span class=hljs-number>1</span>;<span class=hljs-keyword>while</span>(n--)r*=n;<span class=hljs-keyword>return</span> r;}

<span class=hljs-comment>// Unminified ES6 arrow function</span>
<span class=hljs-keyword>let</span> fact = <span class=hljs-function><span class=hljs-params>n</span> =&gt;</span> +(n &lt; <span class=hljs-number>1</span>) || n * fact(n - <span class=hljs-number>1</span>);

<span class=hljs-comment>// Unminified function declaration</span>
<span class=hljs-function><span class=hljs-keyword>function</span> <span class=hljs-title>fact</span>(<span class=hljs-params>n</span>) </span>{ <span class=hljs-keyword>return</span> +(n &lt; <span class=hljs-number>1</span>) || n * fact(n - <span class=hljs-number>1</span>); }
</code></pre>
<p>And minified:</p>
<pre><code class="hljs hljs-js"><span class=hljs-comment>// C/C++</span>
int f(int n){int r=<span class=hljs-number>1</span>;<span class=hljs-keyword>while</span>(n--)r*=n;<span class=hljs-keyword>return</span> r;}

<span class=hljs-comment>// Minified function declaration</span>
<span class=hljs-function><span class=hljs-keyword>function</span> <span class=hljs-title>f</span>(<span class=hljs-params>n</span>)</span>{<span class=hljs-keyword>return</span> +(n&lt;=<span class=hljs-number>0</span>)||n*f(n<span class=hljs-number>-1</span>)}

<span class=hljs-comment>// Minified ES6</span>
<span class=hljs-keyword>let</span> f=<span class=hljs-function><span class=hljs-params>n</span>=&gt;</span>+(n&lt;<span class=hljs-number>1</span>)||n*f(n<span class=hljs-number>-1</span>);
</code></pre>
<p>Here&#39;s an explanation of the hack, comments inline:</p>
<pre><code class="hljs hljs-js"><span class=hljs-comment>// This would probably work in Netscape.</span>
<span class=hljs-function><span class=hljs-keyword>function</span> <span class=hljs-title>fact</span>(<span class=hljs-params>n</span>) </span>{
    <span class=hljs-keyword>return</span> +(n &lt; <span class=hljs-number>1</span>) <span class=hljs-comment>// This implicitly casts from boolean to integer, retaining</span>
                    <span class=hljs-comment>// truthiness. If true, this returns 1 and does not evaluate</span>
                    <span class=hljs-comment>// the right side.</span>
            ||      <span class=hljs-comment>// If falsy, evaluate and return the next part.</span>
            n * fact(n - <span class=hljs-number>1</span>); <span class=hljs-comment>// Standard recursion</span>
}
</code></pre>
<p>Here&#39;s the function without comments again:</p>
<pre><code class="hljs hljs-js"><span class=hljs-function><span class=hljs-keyword>function</span> <span class=hljs-title>fact</span>(<span class=hljs-params>n</span>) </span>{
    <span class=hljs-keyword>return</span> +(n &lt;= <span class=hljs-number>0</span>) || n * fact(n - <span class=hljs-number>1</span>);
}

<span class=hljs-keyword>let</span> fact = <span class=hljs-function><span class=hljs-params>n</span> =&gt;</span> +(n &lt;= <span class=hljs-number>0</span>) || n * fact(n - <span class=hljs-number>1</span>);
</code></pre>
<p>You&#39;ll never beat assembly in speed, though... (this is written for x86 using NASM syntax)</p>
<pre><code class="hljs hljs-x86asm"><span class=hljs-comment>; And almost in size...this is surprisingly short. Uses the cdecl calling</span>
<span class=hljs-comment>; convention.</span>
fact
    <span class=hljs-keyword>pop</span> <span class=hljs-built_in>ecx</span>
    <span class=hljs-keyword>mov</span> <span class=hljs-built_in>eax</span>, <span class=hljs-number>1</span>
<span class=hljs-symbol>.fact:</span>
    <span class=hljs-keyword>mul</span> <span class=hljs-built_in>ecx</span>
    <span class=hljs-keyword>loop</span> .fact
    <span class=hljs-keyword>ret</span>
</code></pre>
</div><div class=post-footer><a class=post-home href=/blog/ >Home ►</a><div class=post-tags><span>Tags:</span><a class=post-tag data-tag=javascript href=/blog/#javascript>javascript</a><a class=post-tag data-tag=entertainment href=/blog/#entertainment>entertainment</a></div></div></div></div></div></div></div></div><div id=license><div><footer><small><p>This site does use Google Analytics for basic tracking (IP addresses anonymized), and a few third parties collect a few cookies their own, like GitHub and some of the creators of the widgets in the <a href=/about/ >About</a>
page's widgets. If you don't consent to these, either stop using this site or just block them in some way, like with a firewall or with a blocker like
<a href=https://adblockplus.org/ >Adblock Plus</a>,
<a href=https://github.com/gorhill/uBlock>uBlock Origin</a>.
<p>All content available on this site by Isiah Meadows is licensed under the Creative Commons Attribution 4.0 International License, and all source code is licensed under the ISC License, unless otherwise specified.
<p><a href=https://github.com/isiahmeadows/website/blob/gh-pages/LICENSE target=_blank rel=license>See here for the text of both of these licenses.</a></small></footer></div></div></div></div><script async src="https://www.googletagmanager.com/gtag/js?id=UA-38960675-5"></script><script>function gtag(){dataLayer.push(arguments)}dataLayer=[["js",new Date],["config","UA-38960675-5",{anonymize_ip:1}]];onerror=function(a,b,c,d){d=(b+" at line: "+c+(d?" column: "+d:"")).trim();c=document.createElement("a");c.href=b;dataLayer.push(["event",a,{event_label:d,event_category:c.hostname!=location.hostname&&c.hostname?"external error":"error",non_interaction:1}],["event","exception",{description:d+": "+a.trim()}])}</script>